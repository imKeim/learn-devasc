<!-- 5.6.1 -->
## Устранение распространенных проблем с сетевым подключением

Может быть много причин, по которым сетевое соединение не работает так, как вы могли ожидать. Всякий раз, когда приложение, веб-сайт или любое целевое место назначения, к которому осуществляется доступ по сети, ведет себя не так, как ожидалось, сеть берет на себя вину. Хотя в некоторых случаях причиной может быть сеть, существует множество других причин, по которым приложения перестают отвечать, как ожидалось.

Устранение неполадок сети обычно следует за уровнями OSI. Вы можете начать сверху вниз, начиная с уровня приложения и заканчивая физическим уровнем. Или вы можете пойти снизу вверх. В этом примере мы рассмотрим типичный сеанс устранения неполадок, начиная с физического уровня и продвигаясь вверх по стеку уровней к уровню приложения.

Прежде всего, с точки зрения клиента, очень важно определить, как клиент подключается к сети. Это проводное или беспроводное соединение?

Если клиент подключается через кабель Ethernet, убедитесь, что сетевая карта подключена к сети и есть электрические сигналы, передаваемые с портом коммутатора, к которому подключен кабель. В зависимости от операционной системы, в которой запущен клиент, состояние сетевого подключения будет отображаться сплошным зеленым светом или будет отображаться текст «включено» или «подключено» рядом с сетевой картой в настройках операционной системы. Если сетевая карта отображается как подключенная, вы знаете, что физический уровень работает должным образом, и можете переместить устранение неполадок в стек. Если сетевая карта на клиенте не отображается как подключенная или включенная, проверьте конфигурацию коммутатора. Возможно, порт, к которому подключается клиент, отключен, или кабель, соединяющий клиента с сетевым портом в стене, неисправен. или кабель, соединяющий сетевой порт от стены до коммутатора, может быть неисправен. Устранение неполадок на физическом уровне в основном сводится к проверке наличия четырех непрерывных пар витых медных кабелей между сетевым клиентом и портом коммутатора.

Если клиент подключается к сети по беспроводной сети, убедитесь, что интерфейс беспроводной сети включен, и он может отправлять и принимать беспроводные сигналы к ближайшей точке беспроводного доступа и от нее. Кроме того, убедитесь, что вы находитесь в зоне действия точки беспроводного доступа, пока вам необходимо быть подключенным к сети.

Переходя на уровень канала передачи данных или уровень 2, убедитесь, что клиент может узнать MAC-адреса назначения (с помощью ARP), а также что коммутатор, к которому подключается клиент, может узнать MAC-адреса, полученные в его портах. В большинстве операционных систем вы можете просмотреть таблицу ARP с помощью команды `arp` (например, `arp –a` на ПК с Windows 10) или на коммутаторах Cisco вы можете проверить таблицу MAC-адресов с помощью команды `show mac address-table`. Если вы можете убедиться, что обе эти таблицы верны, вы можете перейти к следующему уровню. Если клиент не видит никаких MAC-адресов в своей локальной таблице ARP, проверьте списки управления доступом уровня 2 на порту коммутатора, которые могут блокировать этот трафик. Также убедитесь, что порт коммутатора настроен для правильной клиентской VLAN.

На сетевом уровне или уровне 3 убедитесь, что клиент получает правильный IP-адрес от DHCP-сервера или вручную настроен с правильным IP-адресом и правильным шлюзом по умолчанию. Если место назначения вашего трафика находится в другой подсети, чем подсеть, к которой вы подключены, это означает, что трафик должен быть отправлен на локальный маршрутизатор (шлюз по умолчанию). Проверяйте подключение уровня 3 по одному шагу за раз. Сначала проверьте возможность подключения к первому переходу уровня 3 на пути трафика, который является шлюзом по умолчанию, чтобы убедиться, что вы можете его достичь. Если подключение уровня 3 может быть установлено на всем пути от клиента до пункта назначения, переходите к устранению неполадок на транспортный уровень или уровень 4. Если подключение уровня 3 не может быть установлено, проверьте списки доступа IP на интерфейсах маршрутизатора, проверьте таблицу маршрутизации на клиенте и маршрутизаторе шлюза по умолчанию и убедитесь, что трафик маршрутизируется правильно. Проблемы с протоколом маршрутизации и списки управления доступом, блокирующие IP-трафик, являются одними из обычных проблем, встречающихся на этом уровне.

На предыдущем шаге вы проверили сквозную связь между источником и получателем трафика. Это важная веха, так что похлопайте себя по плечу. Вы почти сняли с сетевых специалистов ответственность за сбой в работе этого приложения. Прежде чем обвинять службу поддержки приложений, нужно проверить еще одну вещь. Убедитесь, что клиент может получить доступ к порту, на котором запущено приложение. Если адресатом трафика является веб-страница, обслуживаемая веб-сервером, убедитесь, что порты TCP 80 (HTTP) и 443 (HTTPS) доступны и доступны для клиента. Возможно, веб-сервер работает на эзотерическом порте, таком как 8080, поэтому убедитесь, что вы знаете правильный порт, на котором работает приложение, к которому вы пытаетесь подключиться. Сетевые инструменты, такие как curl или пользовательская команда telnet, указывающая порт приложения, могут использоваться для обеспечения непрерывной работы транспортного уровня между источником и получателем трафика. Если транспортное соединение не может быть установлено, проверьте брандмауэры и устройства безопасности, размещенные на пути трафика, на предмет правил, блокирующих трафик на основе портов TCP и UDP. Проверьте, включена ли балансировка нагрузки и работает ли балансировщик нагрузки, как ожидалось, или какие-либо прокси-серверы, перехватывающие трафик, фильтруют и запрещают соединение.

Итак, вы дошли до этого, проверили сквозное соединение, вы можете подключиться к порту, на котором запущено приложение, так что сетевая команда в курсе, верно? Почти. Еще одна вещь, которую необходимо проверить, - это загрузка трафика и задержка в сети. Сетевые инструменты, такие как iperf, могут генерировать трафик и загружать сеть, чтобы гарантировать, что большие объемы данных могут передаваться между источником и местом назначения. Эти проблемы труднее всего устранить, поскольку их трудно воспроизвести. Они могут быть временно вызваны всплеском сетевого трафика или могут быть вне вашего контроля. Реализация QoS во всей сети может помочь в решении этих проблем. При использовании QoS трафик разделяется на разные сегменты, и каждый сегмент обрабатывается сетью отдельно. Например, трафик в реальном времени,

Или, может быть, вам посчастливилось начать, и вы проверяете доступ к веб-серверу или конечную точку REST API, а сервер возвращает код состояния 500. В этом случае вы можете начать устранение неполадок веб-сервера и пропустить все шаги по устранению неполадок сети.

Если вы так далеко зашли в поиске и устранении неисправностей в сети, велика вероятность, что проблема не в сети, и нужно внимательнее присмотреться к серверу приложений. Медленные или нулевые ответы от приложения также могут означать перегруженную внутреннюю базу данных или просто ошибочный код, введенный с помощью новых функций. В этом случае такие решения, как Cisco AppDynamics, могут предложить более глубокое представление о производительности приложений и анализ первопричин проблем приложений.

<!-- 5.6.2 -->
## Сетевые инструменты - Использование `ifconfig`

`ifconfig` - это программная утилита для операционных систем на базе UNIX. Также существует аналогичная утилита для операционных систем на базе Microsoft Windows под названием `ipconfig`. Основная цель этой утилиты - управлять, настраивать и контролировать сетевые интерфейсы и их параметры. `ifconfig` работает как инструмент интерфейса командной строки и по умолчанию устанавливается с большинством операционных систем.

Общее использование для `ifconfig` следующие:

* Настройте IP-адрес и маску подсети для сетевых интерфейсов.
* Запросить статус сетевых интерфейсов.
* Включение/отключение сетевых интерфейсов.
* Измените MAC-адрес на сетевом интерфейсе Ethernet.

Вывод `ifconfig -–help` в интерфейсе командной строки отобразит все параметры, доступные в этой версии `ifconfig`. Результат должен выглядеть примерно так.

```
devasc@labvm:~$ ifconfig --help
Usage:
  ifconfig [-a] [-v] [-s] <interface> [[<AF>] <address>]
  [add <address>[/<prefixlen>]]
  [del <address>[/<prefixlen>]]
  [[-]broadcast [<address>]]  [[-]pointopoint [<address>]]
  [netmask <address>]  [dstaddr <address>]  [tunnel <address>]
  [outfill <NN>] [keepalive <NN>]
  [hw <HW> <address>]  [mtu <NN>]
  [[-]trailers]  [[-]arp]  [[-]allmulti]
  [multicast]  [[-]promisc]
  [mem_start <NN>]  [io_addr <NN>]  [irq <NN>]  [media <type>]
  [txqueuelen <NN>]
  [[-]dynamic]
  [up|down] ...
<output omitted>

<вывод пропущен>
```

Из этого вывода мы видим, что `ifconfig` дает нам возможность `add`  (добавить) или `del` (удалить) IP-адреса и их маску подсети (префиксную длину) для определенного сетевого интерфейса. Команда `hw ether` дает нам возможность изменить MAC-адрес Ethernet. Следует проявлять осторожность, особенно при отключении интерфейсов, потому что, если вы подключены удаленно к этому хосту через интерфейс, который вы закрываете, вы только что отключили сеанс и, возможно, вам придется физически подойти к устройству, чтобы вернуть его в оперативный режим. Это не такая уж большая проблема, когда устройство находится в комнате по соседству, но это может быть довольно сложно, когда оно физически находится в центре обработки данных за сотни миль, и вам нужно ехать часами или даже лететь, чтобы принести его снова в сети.

Если `ifconfig` выдается без каких-либо параметров, он просто возвращает статус всех сетевых интерфейсов на этом хосте. Для вашей виртуальной машины DEVASC результат должен выглядеть примерно так:

```
devasc@labvm:~$ ifconfig
dummy0: flags=195<UP,BROADCAST,RUNNING,NOARP>  mtu 1500
        inet 192.0.2.1  netmask 255.255.255.255  broadcast 0.0.0.0
        inet6 fe80::48db:6aff:fe27:4849  prefixlen 64  scopeid 0x20<link>
        ether 4a:db:6a:27:48:49  txqueuelen 1000  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 12293  bytes 2544763 (2.5 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

enp0s3: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 10.0.2.15  netmask 255.255.255.0  broadcast 10.0.2.255
        inet6 fe80::a00:27ff:fee9:3de6  prefixlen 64  scopeid 0x20<link>
        ether 08:00:27:e9:3d:e6  txqueuelen 1000  (Ethernet)
        RX packets 280055  bytes 281957761 (281.9 MB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 112889  bytes 10175993 (10.1 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 46014  bytes 14094803 (14.0 MB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 46014  bytes 14094803 (14.0 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

devasc@labvm:~$
```

`MTU` - максимальная единица передачи, указывающая максимальное количество байтов, которое кадр может быть передан на этом носителе до фрагментации.

`RX packets` а также `RX bytes` содержат значения полученных пакетов и байтов соответственно на этом интерфейсе. В приведенном выше примере было получено 280055 пакетов. `enp0s3` интерфейс, содержащий 281,9 МБ данных. `TX packets` и `TX bytes` содержат значения передаваемых пакетов и байтов на этом конкретном интерфейсе. В этом примере было передано 112889 пакетов через `enp0s3` что составляет 10,1 МБ данных.

`ifconfig` до сих пор широко используется как для настройки, так и для мониторинга. Существуют также клиенты с графическим интерфейсом пользователя для большинства операционных систем, которые воплощают эту функциональность в графическом интерфейсе и делают его более наглядным для конечных пользователей при настройке сетевых интерфейсов.

> **Примечание**: Команда `ifconfig` использовалась в Linux много лет. Однако некоторые дистрибутивы Linux не рекомендуют команду `ifconfig`. Команда ip address  становится новой альтернативой. Вы увидите команду `ip address` в некоторых лабораторных работах этого курса.

<!-- 5.6.3 -->
## Использование `ping`

Так же как `ifconfig`, `ping` - это программная утилита, используемая для проверки доступности IP-сети для хостов и устройств, подключенных к определенной сети. Он также доступен практически во всех операционных системах и чрезвычайно полезен для устранения проблем с подключением. Утилита `ping` использует протокол управляющих сообщений Интернета (ICMP) для отправки пакетов на целевой хост, а затем ожидает эхо-ответов ICMP. На основе этого обмена пакетами ICMP, `ping` сообщает об ошибках, потере пакетов, времени приема-передачи, времени жизни (TTL) для полученных пакетов и многом другом.

В Windows 10 введите `ping` для просмотра информации об использовании. Результат должен выглядеть примерно так:

```
C:\> ping

Usage: ping [-t] [-a] [-n count] [-l size] [-f] [-i TTL] [-v TOS]
            [-r count] [-s count] [[-j host-list] | [-k host-list]]
            [-w timeout] [-R] [-S srcaddr] [-c compartment] [-p]
            [-4] [-6] target_name

Options:
    -t             Ping the specified host until stopped.
                   To see statistics and continue - type Control-Break;
                   To stop - type Control-C.
    -a             Resolve addresses to hostnames.
    -n count       Number of echo requests to send.
    -l size        Send buffer size.
    -f             Set Don't Fragment flag in packet (IPv4-only).
    -i TTL         Time To Live.
    -v TOS         Type Of Service (IPv4-only. This setting has been deprecated
                   and has no effect on the type of service field in the IP
                   Header).
    -r count       Record route for count hops (IPv4-only).
    -s count       Timestamp for count hops (IPv4-only).
    -j host-list   Loose source route along host-list (IPv4-only).
    -k host-list   Strict source route along host-list (IPv4-only).
    -w timeout     Timeout in milliseconds to wait for each reply.
    -R             Use routing header to test reverse route also (IPv6-only).
                   Per RFC 5095 the use of this routing header has been
                   deprecated. Some systems may drop echo requests if
                   this header is used.
    -S srcaddr     Source address to use.
    -c compartment Routing compartment identifier.
    -p             Ping a Hyper-V Network Virtualization provider address.
    -4             Force using IPv4.
    -6             Force using IPv6.


C:\>
```

В MacOS Catalina введите `ping` для просмотра информации об использовании. Результат должен выглядеть примерно так:

```
$ ping
usage: ping [-AaDdfnoQqRrv] [-c count] [-G sweepmaxsize]
            [-g sweepminsize] [-h sweepincrsize] [-i wait]
            [-l preload] [-M mask | time] [-m ttl] [-p pattern]
            [-S src_addr] [-s packetsize] [-t timeout][-W waittime]
            [-z tos] host
       ping [-AaDdfLnoQqRrv] [-c count] [-I iface] [-i wait]
            [-l preload] [-M mask | time] [-m ttl] [-p pattern] [-S src_addr]
            [-s packetsize] [-T ttl] [-t timeout] [-W waittime]
            [-z tos] mcast-group
Apple specific options (to be specified before mcast-group or host like all options)
            -b boundif           # bind the socket to the interface
            -k traffic_class     # set traffic class socket option
            -K net_service_type  # set traffic class socket options
            -apple-connect       # call connect(2) in the socket
            -apple-time          # display current time
```

На вашей виртуальной машине DEVASC добавьте `-help`  для возможности просмотра информации об использовании. Результат должен выглядеть примерно так:

```
devasc@labvm:~$ ping -help

Usage
  ping [options] <destination>

Options:
  <destination>      dns name or ip address
  -a                 use audible ping
  -A                 use adaptive ping
  -B                 sticky source address
  -c <count>         stop after <count> replies
  -D                 print timestamps
  -d                 use SO_DEBUG socket option
  -f                 flood ping
  -h                 print help and exit
<output omitted>

IPv4 options:
  -4                 use IPv4
  -b                 allow pinging broadcast
  -R                 record route
  -T <timestamp>     define timestamp, can be one of <tsonly|tsandaddr|tsprespec>

IPv6 options:
  -6                 use IPv6
  -F <flowlabel>     define flow label, default is random
  -N <nodeinfo opt>  use icmp6 node info query, try <help> as argument

For more details see ping(8).
devasc@labvm:~$
```

По умолчанию, `ping` (или `ping –help` в Linux) отобразит все доступные параметры. Некоторые из параметров, которые вы можете указать, включают:

* Подсчитайте, сколько эхо-запросов ICMP вы хотите отправить
* Исходный IP-адрес в случае наличия нескольких сетевых интерфейсов на хосте
* Таймаут ожидания пакета эхо-ответа
* Размер пакета, если вы хотите отправлять пакеты большего размера, чем 64 байта по умолчанию. Этот параметр очень важен при определении MTU интерфейса.

Например, введите команду `ping -c 5 www.cisco.com` в окне терминала вашей виртуальной машины DEVASC, чтобы узнать, доступен ли веб-сервер с вашего ПК и отвечает на эхо-запросы ICMP. Опция `–c` позволяет указать, что нужно отправлять только 5 пакетов ping.

```
devasc@labvm:~$ ping -c 5 www.cisco.com
PING e2867.dsca.akamaiedge.net (23.204.11.200) 56(84) bytes of data.
64 bytes from a23-204-11-200.deploy.static.akamaitechnologies.com (23.204.11.200): icmp_seq=1 ttl=57 time=81.4 ms
64 bytes from a23-204-11-200.deploy.static.akamaitechnologies.com (23.204.11.200): icmp_seq=2 ttl=57 time=28.5 ms
64 bytes from a23-204-11-200.deploy.static.akamaitechnologies.com (23.204.11.200): icmp_seq=3 ttl=57 time=31.5 ms
64 bytes from a23-204-11-200.deploy.static.akamaitechnologies.com (23.204.11.200): icmp_seq=4 ttl=57 time=28.8 ms
64 bytes from a23-204-11-200.deploy.static.akamaitechnologies.com (23.204.11.200): icmp_seq=5 ttl=57 time=26.5 ms

--- e2867.dsca.akamaiedge.net ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 4024ms
rtt min/avg/max/mdev = 26.481/39.335/81.372/21.078 ms
devasc@labvm:~$
```

Результат команды в вашей среде, скорее всего, будет выглядеть немного иначе, но основные компоненты должны быть одинаковыми. Мы указали, что на www.cisco.com должно быть отправлено 5 пакетов эхо-запроса ICMP. Утилита ping автоматически выполняет разрешение DNS и в этом случае разрешает имя www.cisco.com в адрес IPv4 23.204.11.200. Пакеты отправлены, а ответы получены с 23.204.11.2002. TTL для полученных эхо-ответов и время приема-передачи рассчитываются и отображаются. Окончательная статистика подтверждает, что 5 пакетов эхо-запроса ICMP были переданы и 5 пакетов эхо-ответа ICMP были получены, следовательно, потеря пакетов составляет 0,0%. Также отображаются статистические данные о минимальном, среднем, максимальном и стандартном отклонении времени, которое потребовалось пакетам, чтобы добраться до места назначения и обратно.

Имейте в виду, что если вы не получаете ответов от пункта назначения, с которым пытаетесь связаться `ping` это не означает, что хост отключен или недоступен. Это может просто означать, что пакеты эхо-запроса ICMP фильтруются межсетевым экраном и им не разрешено достигать хоста назначения. На самом деле рекомендуется предоставлять только те сервисы, которые должны быть доступны на узлах в сети. Например, веб-сервер будет открывать TCP-порт 443 только для безопасного HTTP-трафика и запрещать любые другие типы трафика либо через локальный межсетевой экран на самом веб-сервере, либо через сетевой межсетевой экран.

Для IPv6 существует аналогичная утилита в Linux и MacOS, которая называется `ping6` и также доступен в большинстве операционных систем. Windows и Cisco IOS используют то же команду `ping` для IPv4 и IPv6.

<!-- 5.6.4 -->
## Использование `traceroute`

Вы видели, как `ping` может отображать доступность хоста в сети. `traceroute` строится на основе этой функциональности и отображает маршрут, по которому пакеты идут к месту назначения. Альтернатива Microsoft Windows также является утилитой командной строки и называется `tracert`. Наблюдение за путем, по которому сетевой трафик проходит от источника к месту назначения, чрезвычайно важно с точки зрения устранения неполадок, поскольку петли маршрутизации и неоптимальные пути могут быть обнаружены и затем устранены.

`traceroute` использует пакеты ICMP для определения пути к месту назначения. Поле Time to Live (TTL) в заголовке IP-пакета используется в первую очередь для предотвращения бесконечных петель в сети. Для каждого перехода или маршрутизатора, через который проходит IP-пакет, поле TTL уменьшается на единицу. Когда значение поля TTL достигает 0, пакет отбрасывается, избегая ужасных бесконечных циклов. Обычно поле TTL устанавливается на максимальное значение 255 на хосте, который является источником трафика, поскольку хост пытается максимизировать шансы того, что этот пакет попадет в пункт назначения. `traceroute` изменяет эту логику и постепенно увеличивает значение TTL пакета, который он отправляет, с 1 и продолжает добавлять 1 к полю TTL для следующего пакета и так далее. Установка значения TTL 1 для первого пакета означает, что пакет будет отброшен на первом маршрутизаторе. По умолчанию большинство маршрутизаторов отправляют обратно источнику трафика пакет ICMP Time Exceeded, информируя его о том, что пакет достиг значения TTL, равного 0, и его необходимо отбросить. `traceroute` использует информацию, полученную от маршрутизатора, для определения его IP-адреса и имени хоста, а также времени приема-передачи.

Примечание: Вместо ICMP по умолчанию Linux использует UDP и высокий диапазон портов (33434–33534). Пункты назначения на пути отвечают сообщениями о недоступности порта ICMP вместо эхо-ответов, отправленных в протоколах трассировки на основе ICMP.

В Windows 10 используйте `tracert` чтобы увидеть доступные параметры, как показано в следующем выводе:

```
C:\> tracert

Usage: tracert [-d] [-h maximum_hops] [-j host-list] [-w timeout]
               [-R] [-S srcaddr] [-4] [-6] target_name

Options:
    -d                 Do not resolve addresses to hostnames.
    -h maximum_hops    Maximum number of hops to search for target.
    -j host-list       Loose source route along host-list (IPv4-only).
    -w timeout         Wait timeout milliseconds for each reply.
    -R                 Trace round-trip path (IPv6-only).
    -S srcaddr         Source address to use (IPv6-only).
    -4                 Force using IPv4.
    -6                 Force using IPv6.

C:\>
```

В MacOS используйте `traceroute` чтобы увидеть доступные параметры, как показано в следующем выводе:

```
$ traceroute
Version 1.4a12+Darwin
Usage: traceroute [-adDeFInrSvx] [-A as_server] [-f first_ttl] [-g gateway] [-i iface]
    [-M first_ttl] [-m max_ttl] [-p port] [-P proto] [-q nqueries] [-s src_addr]
    [-t tos] [-w waittime] [-z pausemsecs] host [packetlen]
```
На вашей виртуальной машине DEVASC используйте `traceroute –-help` чтобы увидеть доступные параметры, как показано в следующем выводе:

```
devasc@labvm:~$ traceroute --help
Usage: traceroute [OPTION...] HOST
Print the route packets trace to network host.

  -f, --first-hop=NUM        set initial hop distance, i.e., time-to-live
  -g, --gateways=GATES       list of gateways for loose source routing
  -I, --icmp                 use ICMP ECHO as probe
  -m, --max-hop=NUM          set maximal hop count (default: 64)
  -M, --type=METHOD          use METHOD (`icmp' or `udp') for traceroute
                             operations, defaulting to `udp'
  -p, --port=PORT            use destination PORT port (default: 33434)
  -q, --tries=NUM            send NUM probe packets per hop (default: 3)
      --resolve-hostnames    resolve hostnames
  -t, --tos=NUM              set type of service (TOS) to NUM
  -w, --wait=NUM             wait NUM seconds for response (default: 3)
  -?, --help                 give this help list
      --usage                give a short usage message
  -V, --version              print program version

Mandatory or optional arguments to long options are also mandatory or optional
for any corresponding short options.

Report bugs to <bug-inetutils@gnu.org>.
devasc@labvm:~$]
```
Несколько вариантов доступны с `traceroute` включая:

* Указание значения TTL для первого отправленного пакета. По умолчанию это 1.
* Указание максимального значения TTL. По умолчанию он увеличивает значение TTL до 64 или до тех пор, пока не будет достигнута цель.
* Указание исходного адреса в случае, если на хосте несколько интерфейсов.
* Указание значения QoS в заголовке IP.
* Указание длины пакета.

Из-за того, как Virtual Box реализует сеть NAT, вы не можете отслеживать за пределами вашей виртуальной машины DEVASC. Вам нужно будет переключить виртуальную машину в режим моста. Но тогда вы не сможете общаться с CSR1000v в других лабораториях. Поэтому мы рекомендуем оставить виртуальную машину в режиме NAT.

Однако вы можете `tracert` с вашего устройства Windows или `traceroute` с вашего устройства MacOS. Следующие выходные данные получены от устройства MacOS в корпоративной сети Cisco, отслеживающего маршрут к одному из веб-серверов Yahoo.

```
$ traceroute www.yahoo.com
traceroute: Warning: www.yahoo.com has multiple addresses; using 98.138.219.232
traceroute to atsv2-fp-shed.wg1.b.yahoo.com (98.138.219.232), 64 hops max, 52 byte packets
 1  sjc2x-dtbb.cisco.com (10.1x.y.z)  2.422 ms  1.916 ms  1.773 ms
 2  sjc2x-dt5.cisco.com (12x.1y.1z.1ww)  2.045 ms
    sjc2x-dt5-01.cisco.com (12x.1y.1z.15w)  2.099 ms  1.968 ms
 3  sjc2x-sbb5.cisco.com (1xx.1x.1xx.4y)  1.713 ms  1.984 ms
    sjc2x-sbb5-10.cisco.com (1xx.1x.1y.4w)  1.665 ms
 4  sjc2x-rbb.cisco.com (1xx.1y.zz.yyy)  1.836 ms  1.804 ms  1.696 ms
 5  sjc1x-rbb-7.cisco.com (1xx.zz.y.ww)  68.448 ms  1.880 ms  1.939 ms
 6  sjc1x-corp-0.cisco.com (1xx.yy.z.w)  1.890 ms  2.660 ms  2.793 ms
 7  * * *
 8  * * *
 9  * * *
 ...
 61  * * *
 62  * * *
 63  * * *
 64  * * *
```
> **Примечание**: Приведенный выше вывод был изменен по соображениям безопасности, но на самом деле ваш вывод должен иметь как действительные имена хостов, так и IP-адреса.

Из этих выходных данных мы можем видеть первые 6 переходов или маршрутизаторов, которые находятся на пути к ww w.yahoo.com. Записи для 2 и 3 имеют два значения, что говорит о том, что на этом конкретном пути реализована балансировка нагрузки. Время приема-передачи также включено в вывод. На этом выходе вы также можете увидеть, что `traceroute`  трафик за пределами корпоративной сети Cisco запрещен, поэтому полный путь к месту назначения недоступен. Путем фильтрации сообщений ICMP Time Exceeded с помощью брандмауэра или простого отключения его на уровне хоста и маршрутизатора видимость пути с помощью traceroute значительно ограничивается. Тем не менее, даже с этими ограничениями, `traceroute` - это чрезвычайно полезная утилита для поиска и устранения проблем, связанных с сетью.

Для IPv6 есть альтернатива под названием `traceroute6` для операционных систем на базе UNIX. `tracert` используется как для IPv4, так и для IPv6 в Windows, однако вы можете использовать параметр -4 или -6 для выбора протокола уровня 3.

<!-- 5.6.5 -->
## Использование `nslookup`

`nslookup` - еще одна служебная программа командной строки, используемая для запроса DNS для получения сопоставления доменного имени с IP-адресом. Как и другие инструменты, упомянутые в этом разделе, `nslookup` широко доступен в большинстве операционных систем. Этот инструмент полезен для определения того, работает ли DNS-сервер, настроенный на конкретном хосте, должным образом и действительно ли преобразует имена хостов в IP-адреса. Возможно, DNS-сервер вообще не настроен на хосте, поэтому обязательно проверьте `/etc/resolv.conf` в UNIX-подобных операционных системах и что у вас есть как минимум `nameserver` определено.

ОС DEVASC VM Linux не поддерживает опцию справки для `nslookup` команда. Однако вы можете ввести `man nslookup` чтобы узнать больше о доступных вариантах.

В терминале выполните команду `nslookup www.cisco.com 8.8.8.8` для разрешения IP-адреса или адресов для веб-сервера Cisco и укажите, что вы хотите использовать DNS-сервер Google в 8.8.8.8 для разрешения.

> **Примечание**: Dig часто является предпочтительным инструментом для запроса DNS.

```
devasc@labvm:~$ nslookup www.cisco.com 8.8.8.8
Server:         8.8.8.8
Address:        8.8.8.8#53

Non-authoritative answer:
www.cisco.com   canonical name = www.cisco.com.akadns.net.
www.cisco.com.akadns.net        canonical name = wwwds.cisco.com.edgekey.net.
wwwds.cisco.com.edgekey.net     canonical name = wwwds.cisco.com.edgekey.net.globalredir.akadns.net.
wwwds.cisco.com.edgekey.net.globalredir.akadns.net      canonical name = e2867.dsca.akamaiedge.net.
Name:   e2867.dsca.akamaiedge.net
Address: 23.204.11.200
Name:   e2867.dsca.akamaiedge.net
Address: 2600:1404:5800:392::b33
Name:   e2867.dsca.akamaiedge.net
Address: 2600:1404:5800:39a::b33

devasc@labvm:~$
```
Служба DNS, работающая на сервере 8.8.8.8, разрешила домен www.cisco.com на 3 IP-адреса, как вы можете видеть выше. Это преобразование имен в IP-адреса критически важно для функционирования любой сети. Намного легче запомнить www.cisco.com, чем адрес IPv4 или IPv6, каждый раз, когда вы пытаетесь получить доступ к веб-сайту Cisco.

<!-- 5.6.6 -->
## Packet Tracer - Устранение распространенных сетевых проблем

В сетях есть множество компонентов, работающих вместе, чтобы обеспечить связь и доставку данных. Часто эти компоненты могут работать некорректно. Это может быть связано с простой неправильной конфигурацией устройства или множеством, казалось бы, не связанных проблем, которые необходимо систематически решать. Как разработчику вам может потребоваться устранить проблемы с сетью, чтобы восстановить подключение. Для устранения неполадок в сети необходимо применять пошаговый методический подход, используя подсказки для определения проблемы и реализации решения. Часто вы можете столкнуться с несколькими проблемами, мешающими работе соединения.

Вы выполните следующие задачи:

* Часть 1. Проверка возможности подключения
* Часть 2: Устранение неполадок R3
* Часть 3: Устранение неполадок R1
* Часть 4: Устранение неполадок DNS

[Устранение распространенных сетевых проблем (pdf)](../05.06.06-lab-troubleshoot-common-network-problems/asset/5.6.6-packet-tracer---troubleshoot-common-network-problems-ru.pdf)
[Устранение распространенных сетевых проблем (pka)](../05.06.06-lab-troubleshoot-common-network-problems/asset/5.6.6-packet-tracer---troubleshoot-common-network-problems-ru.pka)
[Устранение распространенных сетевых проблем (md)](../05.06.06-lab-troubleshoot-common-network-problems/README.md)

<!-- 5.6.7 -->
## Лабораторная работа - Инструменты устранения неполадок сети

Чтобы исправить проблемы с сетевым подключением, разработчику важно понимать, как использовать основные инструменты устранения неполадок сети. Эти инструменты используются, чтобы определить, в чем может быть проблема с подключением.

Вы выполните следующие задачи:

* Часть 1. Запуск виртуальной машины DEVASC
* Часть 2: Изучите инструмент устранения неполадок ifconfig
* Часть 3. Изучите инструмент устранения неполадок ping
* Часть 4. Изучите инструмент устранения неполадок traceroute
* Часть 5. Изучите инструмент устранения неполадок nslookup

[Инструменты устранения неполадок сети](../05.06.07-lab-network-troubleshooting-tools/README.md)
