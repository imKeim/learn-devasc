## Цели

* **Часть 1: Запуск виртуальной машины DEVASC**
* **Часть 2: Изучение документации по API с помощью симулятора API**
* **Часть 3: Использование Postman для вызовов API к симулятору API**
* **Часть 4. Использование Python для добавления 100 книг в симулятор API**

## Предпосылки / Сценарий

Виртуальная машина DEVASC включает симулятор API школьной библиотеки с документацией по API и связанной базой данных. Вы можете использовать симулятор в автономном режиме, чтобы изучить API-интерфейсы и проверить их функциональность.

В этой лабораторной работе вы узнаете, как использовать симулятор API School Library для выполнения вызовов API для отображения, добавления и удаления книг. Позже вы будете использовать Postman для выполнения тех же вызовов API.

## Необходимые ресурсы

-   1 ПК с операционной системой по вашему выбору
-   Virtual Box или VMWare
-   Виртуальная машина DEVASC

## Инструкции

## Часть 1. Запустите виртуальную машину DEVASC

Если вы еще не завершили **лабораторную работу «Установка виртуальной лабораторной среды»**, сделайте это сейчас. Если вы уже выполнили эту лабораторную работу, запустите виртуальную машину DEVASC сейчас.

## Часть 2. Изучите документацию по API с помощью симулятора API

Чтобы понять, как выполнять вызовы REST API, разработчики обычно начинают с изучения документации API. Формат запросов, ответов, заголовков и параметров для REST API обычно документируется с использованием спецификации OpenAPI (ранее - Swagger Specification).

**Шаг 1: Откройте веб-браузер Chromium.**

Дважды щелкните значок веб-браузера Chromium на рабочем столе.

**Шаг 2: Подключитесь к веб-сайту школьной библиотеки.**

Если браузер не открывает веб-сайт School Library автоматически, введите в адресной строке: **library.demo.local** и нажмите клавишу Enter, чтобы перейти туда.

**Шаг 3: Перейдите на страницу документации API.**

1.  По умолчанию на веб-сайте отображается вкладка **Our Books**, на которой отображается список книг. В правом верхнем углу, где указано, **Click here for API docs** (Щелкните здесь, чтобы просмотреть документы API), щелкните слово **here**, чтобы перейти на веб-страницу документации API.

    Теперь вы увидите список API **/api/v1** в **Default namespace** (Пространство имен по умолчанию).

2.  Обратите внимание на направленную вниз стрелку в крайнем правом углу. Щелчок в любом месте панели **/api/v1** свернет список API и повернет стрелку вправо. Щелкните еще раз на той же панели, чтобы снова отобразить список API.

    Обратите внимание на замок справа от нескольких API. Замок означает, что для использования этих API требуется токен.

**Шаг 4: Список книг с помощью API GET /books.**

Щелкните в любом месте панели API **GET /books**. Этот API возвращает список книг в школьной библиотеке.

-   **Parameters** (Параметры) - Есть несколько необязательных параметров API. Их можно использовать для фильтрации, сортировки или разбивки на страницы вывода. Они будут рассмотрены позже в этой лабораторной работе.
-   **Response content type** (Тип содержимого ответа) - Щелкните **application/json**, чтобы просмотреть список различных типов форматов данных, в которых можно просматривать информацию. Оставьте выделенным **application/json**.
-   **Code** (Код) - По умолчанию отображается код 200, что означает, что запрос API от сервера был успешным, как показано в **Description** (Описание). (Вы еще не отправили запрос API.)

**Шаг 5: Воспользуйтесь функцией «Try it out» в документации по API.**

Одна из наиболее мощных функций спецификации OpenAPI - это возможность протестировать вызов API, чтобы убедиться, что вы его правильно создали. Вы также можете просмотреть ответ, чтобы убедиться, что он соответствует вашим ожиданиям. Вы увидите эту же функцию тестирования в документации API для Cisco, MapQuest и других организаций, которые используют эту функцию спецификации OpenAPI.

1.  В документации API **GET /books** нажмите кнопку **Try it out** (Попробовать).

2.  Обратите внимание, что теперь у вас есть возможность ввести информацию для дополнительных параметров. Оставьте параметры пустыми и нажмите кнопку **Execute** (Выполнить).

    В разделе **Responses** (Ответы) вы увидите:

    -   **Curl:** Команда curl, которую вы можете использовать для доступа к той же информации для API /books.
    -   **Request URL:** Этот URL-адрес используется в запросе API, который можно использовать для запроса той же информации с помощью curl, Postman и Python.
    -   **Code**: Это код ответа HTTP. 200 указывает на успешный вызов.
    -   **Response body**: Список книг в формате JSON.
    -   **Response headers**: Информация об API, возвращенная сервером.

    В **Response body** вы увидите список книг в формате JSON:

    ```json
    [
        {
            "id": 0,
            "title": "IP Routing Fundamentals",
            "author": "Mark A. Sportack"
        },
        {
            "id": 1,
            "title": "Python for Dummies",
            "author": "Stef Maruch Aahz Maruch"
        },
        {
            "id": 2,
            "title": "Linux for Networkers",
            "author": "Cisco Systems Inc."
        },
        {
            "id": 3,
            "title": "NetAcad: 20 Years Of Online-Learning",
            "author": "Cisco Systems Inc."
        }
    ]
    ```

**Шаг 6: Используйте команду curl в окне терминала.**

API **GET /books** предоставляет информацию для доступа к содержимому, отображаемому в теле ответа, с помощью curl. curl - это инструмент командной строки для передачи данных на сервер или с сервера с использованием любого из поддерживаемых протоколов, включая HTTP и HTTPS.

1.  Выделите команду `curl`, щелкните правой кнопкой мыши и **скопируйте** (Copy) ее в буфер обмена:

    ```
    curl -X GET "http://library.demo.local/api/v1/books" -H "accept: application/json"
    ```

    От кройте окно терминала. Щелкните правой кнопкой мыши, **вставьте** (Paste) содержимое из буфера обмена в терминал и нажмите Enter. Обратите внимание, что это предоставляет ту же информацию, что и интерфейс OpenAPI библиотеки.

    ```json
    devasc@labvm:~$ curl -X GET "http://library.demo.local/api/v1/books" -H "accept: application/json"
    [
        {
            "id": 0,
            "title": "IP Routing Fundamentals",
            "author": "Mark A. Sportack"
        },
        {
            "id": 1,
            "title": "Python for Dummies",
            "author": "Stef Maruch Aahz Maruch"
        },
        {
            "id": 2,
            "title": "Linux for Networkers",
            "author": "Cisco Systems Inc."
        },
        {
            "id": 3,
            "title": "NetAcad: 20 Years Of Online-Learning",
            "author": "Cisco Systems Inc."
        }
    ]
    devasc@labvm:~$
    ```

**Шаг 7: Перечислите книги с их ISBN с помощью API GET /books.**

1.  Вернитесь к **GET /books** API веб-сайта School Library API.

2.  В разделе **Parameters** (Параметры) щелкните стрелку вниз рядом с параметром **includeISBN** и выберите значение **true**.

3.  Щелкните **Execute** (Выполнить).

    Обратите внимание на следующие изменения в ответах:

    -   **Curl** теперь включает параметр для ISBN.

        ```
        curl -X GET "http://library.demo.local/api/v1/books?includeISBN=true" -H "accept: application/json"
        ```

    -   **Request URL** теперь включает параметр для ISBN.

        ```
        http://library.demo.local/api/v1/books?includeISBN=true
        ```

    -   **Response body** имеет тот же список книг, что и ранее, но теперь включает ISBN книги.

        Чтобы свести к минимуму прокрутку, когда вы закончите с API, вы можете закрыть это конкретное окно API, щелкнув в любом месте строки заголовка. Теперь вам стало проще просматривать весь список API.

**Шаг 8: Получите токен с помощью API POST /loginViaBasic.**

1.  Щелкните API **POST /loginViaBasic**.

2.  Обратите внимание, что нет никаких параметров. Нажмите **Try it out**, а затем **Execute**.

3.  В поле входа будет предложено ввести **username** и **password**. Введите следующую информацию и нажмите **Sign in** (Войти):

    -   **Имя пользователя**: cisco
    -   **Пароль**: Cisco123!

4.  Токен будет отображаться в **Response body**. Выберите информацию между кавычками, щелкните правой кнопкой мыши и **скопируйте** информацию в буфер обмена. **Ваш токен будет отличаться от показанного ниже**.

    ```json
    {
    "token": "cisco|KZZzteQbC5iV3HKEzB7hCJ6qHQXen4rLGh72YJKeVfs"
    }
    ```

5.  Прокрутите до верхней части страницы API школьной библиотеки и нажмите зеленую кнопку **Authorize** (Авторизовать). Появится диалоговое окно **Available authorizations** (Доступные авторизации).

6.  Щелкните правой кнопкой мыши и **вставьте** токен после **Value** и нажмите **Authorize**. Обратите внимание, что **Name** - X-API-KEY. Эта информация вместе с токеном будет использоваться позже в Postman.
        
7.  Закройте диалоговое окно **Available authorizations** и вернитесь к списку API. Обратите внимание, что блокировки некоторых API-интерфейсов теперь изменены. Эти API-интерфейсы теперь доступны для использования.
            
8.  Щелкните панель API **POST /loginViaBasic**, чтобы закрыть окно.

**Шаг 9: Добавьте книги с помощью API POST /books.**

1.  Щелкните API **POST /books**.

2.  Обратите внимание, что в разделе **Parameters** требуется **payload** (полезная нагрузка). Это означает, что этому API требуется информация для этого параметра в формате, заданном в **Parameter content type** (Тип содержимого параметра), которым является JSON.

3.  Щелкните **Try it out**.

4.  Измените **id**, **title** и **author**, используя информацию, показанную ниже.

    ```json
    {
    "id": 4,
    "title": "IPv6 Fundamentals",
    "author": "Rick Graziani"
    }
    ```

5.  Щелкните **Execute**.

1.  Убедитесь, что сообщение было успешным в ответе Сервера. **Код 200** означает, что сообщение прошло успешно. Вы должны увидеть добавленную книгу в **Response body** (тело ответа) вместе с новым идентификатором. Вы также увидите обновленную информацию для `curl` и **URL request**.

1.  Чтобы добавить еще одну книгу, измените идентификатор, название и автора, указав информацию, показанную ниже.

    ```json
    {
    "id": 5,
    "title": "31 Days Before Your CCNA Exam",
    "author": "Allan Johnson"
    }
    ```

6.  Щелкните **Execute**.

7.  Убедитесь, что сообщение было успешным в **Server Response**. **Код 200** означает, что сообщение прошло успешно. Вы должны увидеть добавленную книгу в **Response body** (тело ответа) вместе с новым **id**. Вы также увидите обновленную информацию для **curl** и **URL request**.

    > **Примечание**: Если вы получили код **401**, проверьте текст **Response body**. Скорее всего, вы получили ответ **"error": "Invalid API key"**. Это потому, что вы не ввели все символы для вашего ключа API. Или, возможно, вы добавили в другое место. Вернитесь к предыдущему шагу и повторите процесс авторизации.

8.  Щелкните панель API **POST /books**, чтобы закрыть окно.

9.  Вы можете убедиться, что книги были добавлены на страницу **Our Books**. Вернитесь на вкладку **School Library** в своем браузере (http: //library.demo.local) и обновите страницу. Будьте осторожны, чтобы не закрыть вкладку API школьной библиотеки. Если вы это сделаете, вам нужно будет повторно пройти аутентификацию.

**Шаг 10: Список книг с помощью API GET /books.**

1.  Вернитесь на вкладку **School Library API** в браузере. Щелкните API **GET /books**.

2.  Щелкните **Try it out**. Если вы видите кнопку **Cancel** красного цвета, значит, вы уже находитесь в режиме **Try it out**.

3.  Щелкните **Execute**.

4.  В разделе **Server response** в **Response body** вы увидите две добавленные книги. Обратите внимание, у каждого из них есть уникальный **id**.

    ```json
    [
    {
        "id": 0,
        "title": "IP Routing Fundamentals",
        "author": "Mark A. Sportack"
    },
    {
        "id": 1,
        "title": "Python for Dummies",
        "author": "Stef Maruch Aahz Maruch"
    },
    {
        "id": 2,
        "title": "Linux for Networkers",
        "author": "Cisco Systems Inc."
    },
    {
        "id": 3,
        "title": "NetAcad: 20 Years Of Online-Learning",
        "author": "Cisco Systems Inc."
    },
    {
        "id": 4,
        "title": "IPv6 Fundamentals",
        "author": "Rick Graziani"
    },
    {
        "id": 5,
        "title": "31 Days Before Your CCNA Exam",
        "author": "Allan Johnson"
    }
    ]
    ```

5.  Щелкните панель API **GET /books**, чтобы закрыть окно.

**Шаг 11: Найдите конкретную книгу с помощью API GET /books/{id}.**

1.  Нажмите на API **GET /books/{id}**. Обратите внимание, что для этого API требуется **id** в качестве параметра.

2.  Справа от **Parameters** нажмите кнопку **Try it out**.

3.  В разделе **Parameters** введите 4 для необходимого идентификатора.

4.  Щелкните **Execute**. Обратите внимание на информацию, предоставленную **Curl** и **Request URL**.
    -   **Curl** - Это команда `curl` для выполнения той же функции с использованием `curl`.
    -   **Request URL** - Это URL-адрес, который можно использовать для получения той же информации с помощью Postman и Python.

    Убедитесь, что получение **Server response** было успешным. **Code 200** означает, что сообщение прошло успешно. В **Response body** вы увидите запрошенную книгу с **id** 4.

    ```json
    {
    "id": 4,
    "title": "IPv6 Fundamentals",
    "author": "Rick Graziani"
    }
    ```

5.  Щелкните панель API **GET /books/{id}**, чтобы закрыть окно.

**Шаг 12: Удалите конкретную книгу с помощью API DELETE /books {id}.**

1.  Выберите API **DELETE /books/{id}**. Обратите внимание, что для этого API требуется **id** в качестве параметра.

2.  Щелкните **Try it out**.

3.  В разделе **Parameters** введите 4.

4.  Щелкните **Execute**.

5.  Убедитесь, что удаление было успешным в **Server response**. **Code 200** означает, что сообщение прошло успешно. В **Response body** вы увидите удаленную книгу с **id** 4.

    ```json
    {
    "id": 4,
    "title": "IPv6 Fundamentals",
    "author": "Rick Graziani"
    }
    ```

6.  Щелкните панель API **DELETE /books/{id}**, чтобы закрыть окно.

**Шаг 13: Список книг с помощью API GET /books.**

1.  Щелкните API **GET /books**.

2.  Щелкните **Try it out**. Если вы видите кнопку **Cancel** красным цветом, значит, вы уже находитесь в режиме **Try it out**.

3.  Щелкните **Execute**.

4.  В разделе **Server response** в **теле ответа** вы больше не увидите книгу с **id** или 4.

    ```json
    [
    {
        "id": 0,
        "title": "IP Routing Fundamentals",
        "author": "Mark A. Sportack"
    },
    {
        "id": 1,
        "title": "Python for Dummies",
        "author": "Stef Maruch Aahz Maruch"
    },
    {
        "id": 2,
        "title": "Linux for Networkers",
        "author": "Cisco Systems Inc."
    },
    {
        "id": 3,
        "title": "NetAcad: 20 Years Of Online-Learning",
        "author": "Cisco Systems Inc."
    },
    {
        "id": 5,
        "title": "31 Days Before Your CCNA Exam",
        "author": "Allan Johnson"
    }
    ]
    ```

> **Примечание:** Не закрывайте вкладку **School Library API** в браузере Chromium. В следующей части вы будете использовать документацию по API.

## Часть 3. Использование Postman для вызовов API к симулятору API

В этой части вы будете использовать Postman для выполнения тех же вызовов API, которые вы сделали в документации API студенческой библиотеки. Postman - полезный инструмент, когда веб-сайт разработчика API недоступен, но при этом дает возможность легко сохранять, систематизировать и повторно использовать API.

**Шаг 1: Откройте Postman.**

Дважды щелкните значок Postman на рабочем столе. Обычно вы входите в учетную запись Postman. Однако нет необходимости создавать учетную запись и входить в Postman для лабораторных работ в этом курсе.

**Шаг 2: Составьте список книг с помощью API GET /books.**

1.  В главном окне рядом с вкладкой **Launchpad** щелкните значок плюса «`+`», чтобы создать запрос **Untitled Request**. По умолчанию это будет запрос **GET**.

2.  Щелкните стрелку вниз рядом с **GET**, чтобы просмотреть различные операции API, включая GET, POST и DELETE. Оставьте выбор на **GET**. Щелкните стрелку вверх рядом с **GET**, чтобы закрыть список.

3.  Введите URL-адрес запроса.

1.  Вернитесь на вкладку **School Library API** в Chromium и при необходимости разверните API **GET /books**.

2.  В разделе **Request URL** выберите, щелкните правой кнопкой мыши и скопируйте URL-адрес в буфер обмена:

    ```
    http://library.demo.local/api/v1/books
    ```

3.  Вернитесь в **Postman** и вставьте URL-адрес рядом с GET, где он показывает: «Enter request URL».

    > **Примечание**: Если при вставке под URL-адресом добавляется строка, удалите лишнюю строку.

4.  Щелкните **Send** (Отправить). Чтобы убедиться, что запрос API был успешным, вы увидите ответ, содержащий **Status code** зеленого цвета **200 OK**. Прокрутите вниз до раздела **Body**, чтобы увидеть ответ. Обратите внимание, что по умолчанию это **Pretty** и **json**.

    ```json
    [
        {
            "id": 0,
            "title": "IP Routing Fundamentals",
            "author": "Mark A. Sportack"
        },
        {
            "id": 1,
            "title": "Python for Dummies",
            "author": "Stef Maruch Aahz Maruch"
        },
        {
            "id": 2,
            "title": "Linux for Networkers",
            "author": "Cisco Systems Inc."
        },
        {
            "id": 3,
            "title": "NetAcad: 20 Years Of Online-Learning",
            "author": "Cisco Systems Inc."
        },
        {
            "id": 5,
            "title": "31 Days Before Your CCNA Exam",
            "author": "Allan Johnson"
        }
    ]
    ```

    > **Примечание**: Вы можете сохранить вывод JSON в файл, используя кнопку **Save response** над выводом. Это не требуется для этой лабораторной работы.

**Шаг 3: Получите токен с помощью API POST /loginViaBasic.**

1.  В главном окне щелкните значок плюса «`+`», чтобы создать новый запрос **Untitled Request**.

2.  Щелкните стрелку вниз рядом с **GET** и выберите **POST**.

3.  Введите URL-адрес запроса.

    1.  Вернитесь на вкладку **School Library API** в Chromium и при необходимости разверните API **POST /loginViaBasic**.

    2.  В разделе **Request URL** выберите, щелкните правой кнопкой мыши и скопируйте URL-адрес в буфер обмена:

        ```
        http://library.demo.local/api/v1/loginViaBasic
        ```

        > **Примечание**: Если **Request URL** больше не отображается, возможно, вы закрыли и повторно открыли страницу документации **School Library API** и больше не прошли проверку подлинности. Нажмите **Try it out**, затем **Execute**, а затем повторно авторизуйтесь с использованием имени пользователя **cisco** и пароля **Cisco123!**.

    3.  Вернитесь в **Postman** и вставьте URL-адрес рядом с POST, где он показывает: "Enter request URL".

        > **Примечание**: Если при вставке под URL-адресом добавляется строка, удалите лишнюю строку.

4.  Щелкните **Auth**. В этой области выполните следующие действия:

    1.  В раскрывающемся списке для **Type** выберите **Basic Auth**.

    2.  В полях **Username** и **Password** введите следующие данные:

        -   **Username:** cisco
        -   **Password:** Cisco123!

5.  Щелкните **Send**.

6.  При необходимости прокрутите вниз до раздела **Body**, чтобы увидеть новый токен. **Ваш токен будет отличаться от показанного здесь.**

    ```json
    {
        "token": "cisco|5xSUHYFDvIAoCRv0LqWVSDcjJAwWjg18vMml6u2lm1I"
    }
    ```

**Шаг 4: Добавьте книгу с помощью API POST /books.**

Теперь вы добавите книгу *IPv6 Fundamentals*, которую вы удалили в части 2 при использовании функции **Try it out** в документации **School Library API**.

1.  В главном окне щелкните значок плюса «`+`», чтобы создать запрос **Untitled Request**.

2.  Щелкните стрелку вниз рядом с **GET** и выберите **POST**.

3.  Введите URL-адрес запроса.

    1.  Вернитесь на вкладку **School Library API** в Chromium и разверните API **POST /books**.

    2.  В разделе **Request URL** выберите, щелкните правой кнопкой мыши и скопируйте URL-адрес в буфер обмена:

        ```
        http://library.demo.local/api/v1/books
        ```

        > **Примечание**: Если **Request URL** больше не отображается, возможно, вы отменили опцию **Try it out**. Нажмите **Try it out**, а затем **Execute**, чтобы отобразить **Request URL**.

    3.  Вернитесь в **Postman** и вставьте URL-адрес рядом с POST, где он показывает: "Enter request URL".

        > **Примечание**: Если при вставке под URL-адресом добавляется строка, удалите лишнюю строку.

4.  Щелкните **Authorization**. В этой области выполните следующие действия:

    1.  В раскрывающемся списке **Type** выберите **API Key**.
    
    2.  В поле Ключ введите **X-API-KEY**.

        > **Примечание**: Напомним, что вы видели **X-API-KEY** на веб-странице School Library API, когда вы получили токен, нажав зеленую кнопку **Authorize**.

    3.  Вернитесь на вкладку **Post** в Postman и скопируйте токен, полученный на шаге 3. Обязательно укажите все в кавычках. Ваш токен будет отличаться от показанного здесь.

        Пример: `cisco|5xSUHYFDvIAoCRv0LqWVSDcjJAwWjg18vMml6u2lm1I`

    4.  Вернитесь на вторую вкладку **Post** в Postman. Вставьте токен в поле **Value**

5.  В той же строке, что и вкладка **Authorization**, щелкните **Body**. Этот раздел позволит вам выбрать формат вашего ввода.

    -   Щелкните переключатель **raw**.
    -   Щелкните **Text** и измените этот параметр на **JSON**.

6.  В области ввода вы увидите цифру 1 для «строки 1». Введите следующий объект JSON.

    ```json
    {
    "id": 4,
    "title": "IPv6 Fundamentals",
    "author": "Rick Graziani",
    "isbn": "978 158144778"
    }
    ```

7.  Щелкните **Send**.

8.  Чтобы убедиться, что запрос API был успешным, вы увидите ответ, содержащий код **Status** зеленого цвета 200 OK.

**Шаг 5: Проверьте добавленную книгу с помощью API GET /books.**

1.  Вернитесь на первую вкладку GET. Как видите, Postman позволяет легко переключаться между различными вызовами API.

2.  Щелкните **Send**.

3.  Чтобы убедиться, что запрос API был успешным, вы увидите ответ, содержащий код **Status** зеленого цвета 200 OK.

4.  Щелкните **Body**, чтобы увидеть ответ. Обратите внимание, что по умолчанию это **Pretty** и **json**.

    ```json
    [
        {
            "id": 0,
            "title": "IP Routing Fundamentals",
            "author": "Mark A. Sportack"
        },
        {
            "id": 1,
            "title": "Python for Dummies",
            "author": "Stef Maruch Aahz Maruch"
        },
        {
            "id": 2,
            "title": "Linux for Networkers",
            "author": "Cisco Systems Inc."
        },
        {
            "id": 3,
            "title": "NetAcad: 20 Years Of Online-Learning",
            "author": "Cisco Systems Inc."
        },
        {
            "id": 4,
            "title": "IPv6 Fundamentals",
            "author": "Rick Graziani"
        }
        {
            "id": 5,
            "title": "31 Days Before Your CCNA Exam",
            "author": "Allan Johnson"
        },
    ]
    ```

**Шаг 6: Используйте дополнительные параметры с API Get /books.**

1.  Перейдите на веб-сайт **School Library API**. Прокрутите до **GET /books** API и при необходимости раскройте его.

    Обратите внимание на доступные параметры:

    -   **includeISBN**: Включает в результаты номера ISBN. Default=false
    -   **sortBy**: Отсортировать результаты по указанному параметру. Default=id
    -   **author**: Возвращать только книги указанного автора.
    -   **page**: Используется для указания номера страницы.

2.  Щелкните **Try it out**. Если вы видите кнопку **Cancel** красного цвета, вам не нужно нажимать эту кнопку.

3.  По параметрам:
    -   Нажмите **includeISBN** и выберите **true**
    -   Нажмите **sortBy** и выберите **author**

4.  Щелкните **Execute**.

5.  В теле ответа **Response body** вы увидите список книг, отсортированный по авторам и включая ISBN.

    ```json
    [
        {
            "id": 5,
            "title": "31 Days Before Your CCNA Exam",
            "author": "Allan Johnson"
        },
        {
            "id": 2,
            "title": "Linux for Networkers",
            "author": "Cisco Systems Inc.",
            "isbn": "000-0000000123"
        },
        {
            "id": 3,
            "title": "NetAcad: 20 Years Of Online-Learning",
            "author": "Cisco Systems Inc.",
            "isbn": "000-0000001123"
        },
        {
            "id": 0,
            "title": "IP Routing Fundamentals",
            "author": "Mark A. Sportack",
            "isbn": "978-1578700714"
        },
        {
            "id": 4,
            "title": "IPv6 Fundamentals",
            "author": "Rick Graziani",
            "isbn": "978 1587144778"
        },
        {
            "id": 1,
            "title": "Python for Dummies",
            "author": "Stef Maruch Aahz Maruch",
            "isbn": "978-0471778646"
        }
    ]
    ```

    Обратите внимание, что **Request URL** теперь включает параметры. Вы снова увидите это в Postman.

    ```
    http://library.demo.local/api/v1/books?includeISBN=true&sortBy=author
    ```

6.  Вернитесь в **Postman** и перейдите на первую вкладку API, GET http://library.demo.local/api/v1/books. Теперь вы включите некоторые параметры с веб-сайта School Library API.

7.  Щелкните **Params**. Вы увидите поля ввода параметров запроса **Query Params** для **KEY** и **VALUE**. Введите следующую информацию:

    -   В разделе **KEY** введите **includeISBN**, а в разделе **Value** введите **true**.

        Обратите внимание, что слева от значения автоматически появится галочка, и будет добавлена новая строка.

    -   В разделе **KEY** введите **sortBy**, а в разделе **Value** введите **author**.

    Обратите внимание, что при вводе этих параметров запроса он обновил исходный URL-адрес рядом с GET. Это тот же **Request URL**, который вы видели на веб-сайте API школьной библиотеки для того же вызова API. Это URL-адрес, который Postman будет использовать с этими параметрами запроса при вызове API.

    ```
    http://library.demo.local/api/v1/books?includeISBN=true&sortBy=author
    ```

8.  Щелкните **Send**.

    Обратите внимание, что в **Body** теперь отображается тот же список книг, отсортированный по автору и включающий номера ISBN, который вы видели на веб-сайте School Library API.

    ```json
    [
        {
            "id": 5,
            "title": "31 Days Before Your CCNA Exam",
            "author": "Allan Johnson"
        },
        {
            "id": 2,
            "title": "Linux for Networkers",
            "author": "Cisco Systems Inc.",
            "isbn": "000-0000000123"
        },
        {
            "id": 3,
            "title": "NetAcad: 20 Years Of Online-Learning",
            "author": "Cisco Systems Inc.",
            "isbn": "000-0000001123"
        },
        {
            "id": 0,
            "title": "IP Routing Fundamentals",
            "author": "Mark A. Sportack",
            "isbn": "978-1578700714"
        },
        {
            "id": 4,
            "title": "IPv6 Fundamentals",
            "author": "Rick Graziani",
            "isbn": "978 1587144778"
        },
        {
            "id": 1,
            "title": "Python for Dummies",
            "author": "Stef Maruch Aahz Maruch",
            "isbn": "978-0471778646"
        }
    ]
    ```

## Часть 4. Используйте Python, чтобы добавить 100 книг в симулятор API

Вы можете использовать инструмент OpenAPI Specification Try It out или Postman, чтобы добавить столько книг, сколько захотите. Однако вам придется добавлять их по одному. Лучшим решением было бы написать программу для добавления книг. В этой части вы смоделируете процесс добавления 100 книг с помощью библиотеки Python **faker**.

**Шаг 1: Откройте код Visual Studio (VS) и перейдите в каталог school-library.**

1.  Откройте **VS Code** с помощью кнопки **Menu** или дважды щелкнув значок на рабочем столе.

2.  Щелкните **File \> Open Folder...**, перейдите в папку **labs/devnet-src/school-library** и щелкните **OK**.

**Шаг 2: Изучите библиотеки, используемые программой add100RandomBooks.py.**

1.  На панели VS Code **EXPLORER** слева щелкните **add100RandomBooks.py**, чтобы открыть его, если необходимо.

2.  Вверху обратите внимание на «shebang», который устанавливает интерпретатор в Python 3, а затем три импортируемые библиотеки.

    ```python
    #!/usr/bin/env python3

    import requests
    import json
    from faker import Faker
    ```

3.  На протяжении всего курса вы будете использовать библиотеку **requests** Python. Библиотека **requests** необходима, если вы хотите использовать Python для выполнения запросов API с использованием GET, POST, DELETE и других методов HTTP.

4.  Faker - это библиотека Python, которая генерирует для вас «поддельные» данные. Эта программа использует библиотеку Python **faker** для генерации случайных названий книг, авторов и ISBN. Вы можете поискать в Интернете дополнительную информацию о библиотеке **faker**. Однако выполните следующие шаги, чтобы увидеть все 252 метода для библиотеки faker.

    1.  Откройте окно терминала и запустите Python 3.

    2.  Из модуля **faker** импортируйте **Faker()**.

    3.  Назначьте **fake** значение **Faker()**.

    4.  Чтобы увидеть все методы, введите **fake.**, а затем дважды нажмите клавишу табуляции. Обратите внимание на метод **fake.name()**, который вы будете использовать на следующем шаге. На следующем этапе и позже в этой лабораторной работе вы также будете использовать три выделенных метода (с префиксом **fake.**): **catch_phrase()**, **isbn13()** и **name()**.

    ```
    devasc@labvm:~/labs/devnet-src/school-library$ python3
    Python 3.8.2 (default, Apr 27 2020, 15:53:34) 
    [GCC 9.3.0] on linux
    Type "help", "copyright", "credits" or "license" for more information.
    >>> from faker import Faker
    >>> fake = Faker()
    >>> fake.<press Tab key twice – be sure you include the period>
    Display all 252 possibilities? (y or n)
    fake.add_provider(               fake.future_datetime(            fake.pyfloat(
    fake.address(                    fake.generator_attrs             fake.pyint(
    fake.am_pm(                      fake.get_formatter(              fake.pyiterable(
    <output omitted>
    fake.catch_phrase(               fake.ipv4_public(                fake.random_element(
    fake.chrome(                     fake.isbn10(                     fake.random_int(
    fake.city(                       fake.isbn13(                     fake.random_letter(
    <output omitted>
    fake.date_time_ad(               fake.msisdn(                     fake.texts(
    fake.date_time_between(          fake.name(                       fake.time(
    <output omitted>
    fake.future_date(                fake.pydict(                     fake.zipcode_plus4(
    >>>
    ```

**Шаг 3: Потренируйтесь генерировать случайные данные с помощью библиотеки faker.**

1.  Введите следующее, чтобы создать поддельное имя. Ваш вывод будет иметь другое поддельное имя каждый раз, когда вы выполняете команду.

    ```
    >>> print('My name is {}.'.format(fake.name()))
    My name is Katherine Ross.
    >>>
    ```

2.  Используя три выделенных сообщения на шаге 2d выше, введите команду, которая распечатает следующий вывод fake.

    Напишите здесь свои ответы.

    ```
    My name is Gary Castaneda and I wrote "Organic incremental neural-net" (ISBN 978-0-669-01935-3).
    >>>
    ```

3.  Позже в программе используется цикл для перебора этих трех методов для создания записей для школьной библиотеки. Введите следующее, чтобы сгенерировать 10 случайных имен. После «…» вам нужно будет нажать клавишу Enter во второй раз.

    ```python
    >>> for i in range(10):
    ...     print(fake.name())
    ... 
    Kevin Moyer
    Mr. Christopher Green MD
    Spencer Jensen
    Whitney Guzman
    Nicole Scott
    Tammy Lewis
    Craig Edwards
    Michael Diaz
    Ryan Mccoy
    Terry Rocha
    >>>
    ```

4.  Закройте интерпретатор Python, когда закончите исследование библиотеки **faker**.

    ```
    >>> quit()
    devasc@labvm:~/labs/devnet-src/school-library$
    ```

**Шаг 4: Просмотрите функциональные переменные.**

Две функции в программе используют три переменные для получения токена авторизации из службы API школьной библиотеки.

```
APIHOST = "http://library.demo.local"
LOGIN = "cisco"
PASSWORD = "Cisco123!"
```

**Шаг 5: Просмотрите функцию getAuthToken.**

1.  Функция **getAuthToken** использует три переменные для создания запроса. Переменная r вызывает метод POST для API **loginViaBasic** и сохраняет значение токена, если вызов успешен. Обратите внимание на использование f-строки для построения URL-адреса запроса.

    ```python
    def getAuthToken():
        authCreds = (LOGIN, PASSWORD)
        r = requests.post(
            f"{APIHOST}/api/v1/loginViaBasic", 
            auth = authCreds
        )
    ```

2.  Если вызов завершился неудачно (код состояния HTTP не равен 200), возникает исключение, которое выводится в окно терминала. Опять же, обратите внимание на использование f-строки для создания сообщения об исключении. Вы можете протестировать код исключения, изменив одну из переменных на шаге 4.

    ```python
        if r.status_code == 200:
            return r.json()["token"]
        else:
            raise Exception(f"Status code {r.status_code} and text {r.text}, while trying to Auth.")
    ```

**Шаг 6: Просмотрите функцию addBook.**

1.  Подобно функции **getAuthToken**, функция **addBook** использует три переменные, показанные на шаге 4, для создания запроса. Переменная **r** вызывает метод POST для API книг. Данные поступают из переменной с именем **book**, которая указывается в последней части программы.

    ```python
    def addBook(book, apiKey):
        r = requests.post(
            f"{APIHOST}/api/v1/books", 
            headers = {
                "Content-type": "application/json",
                "X-API-Key": apiKey
                },
            data = json.dumps(book)
        )
    ```

2.  Если вызов завершился неудачно, возникает исключение, которое выводится в окно терминала. Вы можете проверить это, изменив одну из переменных на шаге 4.

    ```python
        if r.status_code == 200:
            print(f"Book {book} added.")
        else:
            raise Exception(f"Error code {r.status_code} and text {r.text}, while trying to add book {book}.")
    ```

**Шаг 7: Просмотрите код, который вызывает две функции.**

1.  Вызывается функция **getAuthToken**, и результаты сохраняются в переменной **apiKey**.

    ```python
    apiKey = getAuthToken()
    ```

2.  Модуль **Faker()** настроен на переменную с именем **fake**. Затем цикл **for** повторяется 100 раз. Переменная **i** используется позже в цикле для установки значения ключа **id** для каждой новой книги от 4 до 104 включительно.

    > **Примечание**: Если вы хотите сохранить две предыдущие книги, добавленные ранее в этой лабораторной работе, измените **range** (диапазон) на **(6, 106)**.

    ```python
    fake = Faker()
    for i in range(4, 104):
    ```

3.  Затем в трех переменных хранятся значения методов, вызываемых из модуля **Faker()**: **catch_phrase()**, **name()** и **isbn13()**.

    ```python
        fakeTitle = fake.catch_phrase()
        fakeAuthor = fake.name()
        fakeISBN = fake.isbn13()
    ```

4.  Напомним, что параметр **payload** для API **books** требует JSON в следующем формате:

    ```python
    {
    "id": 0,
    "title": "string",
    "author": "string"
    }
    ```

    Переменная **book** создается с использованием трех обязательных ключей для параметра полезной нагрузки и значений из трех фиктивных переменных.

    ```python
        book = {"id":i, "title": fakeTitle, "author": fakeAuthor, "isbn": fakeISBN}
    ```

1.  Наконец, вызывается функция **addBook**, передающая переменные **book** и **apiKey**. Поскольку **addBook** является частью цикла, он будет вызываться 101 раз, по одному разу для книг с идентификаторами от 4 до 105.

**Шаг 8: Запустите и проверьте программу add100RandomBooks.py.**

1.  Введите команду Python 3, чтобы запустить программу **add100RandomBooks.py**. Вы должны получить результат, аналогичный приведенному ниже, хотя названия ваших книг и номера ISBN будут разными поддельными значениями.

    ```
    devasc@labvm:~/labs/devnet-src/school-library$ python3 add100RandomBooks.py
    Book {'id': 4, 'title': 'Assimilated client-server frame', 'author': 'Chelsea Mitchell', 'isbn': '978-0-411-83123-3'} added.
    Book {'id': 5, 'title': 'Adaptive tangible conglomeration', 'author': 'Edward Ryan', 'isbn': '978-1-64406-014-8'} added.
    <output omitted>
    Book {'id': 103, 'title': 'Fundamental uniform data-warehouse', 'author': 'Dennis David', 'isbn': '978-1-68465-896-1'} added.
    Book {'id': 104, 'title': 'Organic 4thgeneration functionalities', 'author': 'Nicole Gilbert', 'isbn': '978-0-13-176202-2'} added.
    devasc@labvm:~/labs/devnet-src/school-library$
    ```

1.  Вернитесь в браузер Chromium и обновите веб-страницу **http://library.demo.local/**. Теперь вы должны увидеть добавленные 100 новых книг.

    > **Примечание**: Если вы перешли на страницу документации API, а не на главную страницу (**http://library.demo.local/api/v1/docs**) и использовали **Try It out**, вы получите только список из первых 10 книг. Вы можете ввести значение от 2 до 10 для параметра **page**, чтобы увидеть другие книги.

    Как бы вы добавили еще 100 книг?
